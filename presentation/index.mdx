import { Cite, Notes, Appear } from 'spectacle'

import { DarkSlide, CodeSlide } from './slides'
import { GuessTheType } from './GuessTheType'

## the time and place for

# Implementation Details

---

## Agenda

### Implementation Details

- joke about accent
- elevator pitch
- contrived example
- realistic example
- what even are they?
- how to escape them
- when to focus on them

<Notes>... You know what I love?</Notes>

---

talking about implementation details

## üß°

<Appear>
  <div>
    <ul>
      <li>
        Which database? UI Framework? State Management?
      </li>
      <li>
        Modal? Hidden inputs? Forcefully open in a new tab?
      </li>
    </ul>
  </div>
</Appear>

<Notes>
Has APPEAR

... You know what I dislike?

</Notes>

---

listening to people talk about implentation details

## üòë

<Notes>
Sucks to be you guys I guess!

No, nobody's here against their will, hopefully! What I mean is in meetings, even architecture meetings, you should be reraining from indulging into going too far in the weeds.

... You know what I hate?

</Notes>

---

testing implementation details

## ü§¨

<Notes>

This is an engineering only pain, but his is a mostly engineering conference so we'll be focusing on it.

How do we even get to a place where we test implementation details?

</Notes>

---

## Problem

- You solve problems using code
- You want to be confident your code solves them forever
- You want your code to be easy to improve

---

## Solution

- You write tests üéâ
- You are confident your code solves the problems it's currently solving forever more ‚úÖ
- But **every time** your tests are **too coupled to implentation details**, you make your code **harder** to improve üò±

---

export default CodeSlide

```typescript
const getOnlineFriends = (
  friendIds: User,
  allUsers: User[]
) =>
  allUsers
    .filter(({ id }) => friendIds.includes(id))
    .filter(({ online }) => online)
```

---

export default CodeSlide

```typescript
const getOnlineFriends = (
  friendIds: User,
  allUsers: User[]
) =>
  allUsers.filter(
    ({ online, id }) => online && friendIds.includes(id)
  )
```

---

Error: expected `filter` to be called twice

---

export default CodeSlide

```typescript
it('only returns online friends', () => {
  const onlineFriends = getOnlineFriends(user, allUsers)
  expect(Array.prototype.filter).toBeCalledTimes(2) // ü§™

  expect(onlineFriends).toEqual([
    // ...
  ])
})
```

<Notes>
  Wait a minute? Has anybody EVER done this? The answer is
  yes. But this is the contrived example.
</Notes>

---

export default CodeSlide

```typescript
const allUsers = knex.select('*').from<User>('users')
const onlineFriends = getOnlineFriends(user, allUsers)
```

---

export default CodeSlide

```typescript
const friends = knex
  .select('*')
  .from<User>('users')
  .whereIn('id', user.friendIds)
  .where('online', true)
```

---

Error: `.whereIn` is not a function

---

export default CodeSlide

```typescript
const mockKnex = {}
mockKnex.select = jest.fn(() => mockKnex)
mockKnex.from = jest.fn(() => mockKnex)
jest.mock('knex', () => mockKnex)
```

---

export default CodeSlide

```typescript
const user = userStore.getUserWithFriends('not-that-talk')
```

---

### What are implementation details?

---

Let's say we've got this design:

---

Even the form is an implementation detail!

---

## Goal: Allow users to pick a username

---

## Goal: Allow users to be identifiable without using their real names

---

can you tell which uses hooks?

<GuessTheType />

---

> `typeof` doesn't discriminate, why should your tests?

---

There are frameworks that make testing implementation details too easy

---

export default CodeSlide

```typescript
const component = shallow(<ChangeUsername />)
component.setState({ isValid: false })

expect(input.prop('success')).toBe(false)
expect(input.prop('error')).toBe(true)

component.setState({ isValid: true })
const input = component.find(Input)

expect(input.prop('success')).toBe(true)
expect(input.prop('error')).toBe(false)
```

---

There are frameworks that help you avoid implementation details

---

![cypress](https://www.valentinog.com/blog/wp-content/uploads/2017/11/end-to-end-testing-cypress-create-article.gif)

cypress.io

---

![testing-libary](https://i.ibb.co/fr7nJyS/testing-library.png)

testing-library.com üêô

---

export default CodeSlide

```typescript
const { getByLabelText, getByText } = render(
  <ChangeUsername />
)
const input = getByLabelText('Username')

// user inputs a short username
userEvent.click(input)
userEvent.type(input, 'Pop')
userEvent.tab()

expect(getByText('that is too short')).toBeTruthy()

// user inputs a valid username
userEvent.click(input)
userEvent.type(input, 'PopCultureReference')
userEvent.tab()

expect(getByText(/claim it/)).toBeTruthy()
```

---

export default CodeSlide

```typescript
const { getByLabelText, getByText } = render(
  <ChangeUsername />
)
const input = getByLabelText('Username')

// user inputs a "taken" username
userEvent.click(input)
userEvent.type(input, 'jmagrippis')
userEvent.tab()

expect(getByText(/checking availability/)).toBeTruthy()
expect(await findByText(/not available/).toBeTruthy()

// user inputs an available username
userEvent.click(input)
userEvent.type(input, 'notjmagrippis')
userEvent.tab()

expect(await findByText(/claim it/).toBeTruthy()
```

---

export default CodeSlide

```typescript
import fetchMock from 'fetch-mock'
fetchMock
  .get('/users/jmagrippis', 200)
  .get('/users/notjmagrippis', 404)
```

---

GraphQL refactor?

---

testing library render overwrite

---

## Implementation Details

- Can delight or frustrate your users... if they get there
- Can delight or frustrate your team... if you do iterate

---

![starbucks](https://www.geek.com/wp-content/uploads/2019/05/Starbucks-GoT-Coffee-Cup-5619-625x352.jpg)

---

## Implementation Details

- Be aware of them... in silence
- Do get into them in private, specialist to specialist
- After you have an idea of the high level goals
- As little as possible in your tests

---

## Implementation Details

- This presenation was written in `mdx`
- Using Spectacle from Formidable Labs
- Hosted on Netlify
- Example on Code Sandbox

---

# Thanks!

### üé§ Questions? üé§

<Cite>@jmagrippis</Cite>
